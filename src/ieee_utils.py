from glob import glob
import os
import re
import sys
import yaml
import datetime
import numpy as np
import pandas as pd
from func.utils import get_categorical_features, to_pkl_gzip
from func.ml_utils import Classifier
from func.BigQuery import BigQuery
from sklearn.model_selection import StratifiedKFold, GroupKFold
from bq_log import create_train_log_table, save_train_log


COLUMN_ID = 'TransactionID'
COLUMN_TARGET = 'isFraud'
COLUMNS_IGNORE = [COLUMN_ID, COLUMN_TARGET]


def get_os_release_date():
    os_release_map = {
        'android': {
            '4.4.2'   :  '2013-12-09',
            '5.0'     :  '2014-11-12',
            '5.0.2'   :  '2014-12-19',
            '5.1.1'   :  '2015-03-09',
            '6.0'     :  '2015-10-05',
            '6.0.1'   :  '2015-12-7',
            '7.0'     :  '2016-08-22',
            '7.1.1'   :  '2016-12-05',
            '7.1.2'   :  '2017-04-04',
            '8.0.0'   :  '2017-08-21',
            '8.1.0'   :  '2017-12-05',
            '9'       :  '2018-08-06',
        },
        'ios': {
            '9.3.5'       :  '2016-08-25',
            '10.0.2'      :  '2016-09-23',
            '10.1.1'      :  '2016-10-31',
            '10.2.0'      :  '2016-12-12',
            '10.2.1'      :  '2017-01-23',
            '10.3.1'      :  '2017-04-03',
            '10.3.2'      :  '2017-05-15',
            '10.3.3'      :  '2017-07-19',
            '11.0.0'      :  '2017-09-19',
            '11.0.1'      :  '2017-09-26',
            '11.0.2'      :  '2017-10-03',
            '11.0.3'      :  '2017-10-11',
            '11.1.0'      :  '2017-10-31',
            '11.1.1'      :  '2017-11-09',
            '11.1.2'      :  '2017-11-16',
            '11.2.0'      :  '2017-12-02',
            '11.2.1'      :  '2017-12-13',
            '11.2.2'      :  '2018-01-08',
            '11.2.5'      :  '2018-01-23',
            '11.2.6'      :  '2018-02-19',
            '11.3.0'      :  '2018-03-29',
            '11.3.1'      :  '2018-04-24',
            '11.4.0'      :  '2018-05-29',
            '11.4.1'      :  '2018-07-09',
            '12.0.0'      :  '2018-09-16',
            '12.0.1'      :  '2018-10-09',
            '12.1.0'      :  '2018-11-05',
            '12.1.1'      :  '2018-12-05',
            '12.1.2'      :  '2018-12-16',
        },
        'mac':{
            '10.6'   :'2010-08-28',
            '10.6.8' :'2011-06-23',
            '10.7.5' :'2012-09-19',
            '10.8.5' :'2013-09-12',
            '10.9'   :'2013-10-22',
            '10.9.5' :'2014-09-17',
            '10.10'  :'2014-10-16',
            '10.10.5':'2015-08-13',
            '10.11'  :'2015-09-30',
            '10.11.3':'2016-01-19',
            '10.11.4':'2016-03-20',
            '10.11.5':'2016-03-20',
            '10.11.6':'2016-07-18',
            '10.12'  :'2016-09-20',
            '10.12'  :'2016-09-20',
            '10.12.1':'2016-10-24',
            '10.12.2':'2016-12-13',
            '10.12.3':'2017-01-23',
            '10.12.4':'2017-03-27',
            '10.12.5':'2017-05-15',
            '10.12.6':'2017-07-19',
            '10.13'  :'2017-09-25',
            '10.13.1':'2017-10-31',
            '10.13.2':'2017-12-06',
            '10.13.3':'2018-01-23',
            '10.13.4':'2018-03-29',
            '10.13.5':'2018-06-01',
            '10.13.6':'2018-07-09',
            '10.14'  :'2018-09-01',
            '10.14.0':'2018-09-01',
            '10.14.1':'2018-10-30',
            '10.14.2':'2019-12-05',
            '10.14.3':'2019-01-22',
        },
        'windows':{
            'xp': '2001-10-25',
            'vista': '2007-01-30',
            '7': '2009-10-22',
            '8': '2012-10-26',
            '8.1': '2013-10-18',
            '10': '2015-07-29',
        }
    }
    return os_release_map